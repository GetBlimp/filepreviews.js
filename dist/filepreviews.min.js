/* filepreviews 1.0.3 */
!function(){"use strict";var a,b="https://blimp-previews.herokuapp.com/?size=1&url=",c="http://demo.filepreviews.io.s3-website-us-east-1.amazonaws.com/";return a=function(a){a=a||{},this._cache={},this.debug=a.debug||!1,this.resultsUrl=a.resultsUrl||c},a.prototype._log=function(a){return this.debug&&console.log(a),this},a.prototype.hash=function(a){if(!CryptoJS)throw new Error("CryptoJS library not found.");return CryptoJS.SHA256(a).toString()},a.prototype.generate=function(a,b){var c,d=this.hash(a);this._cache[d]?(this._log("Cache hit"),c=this._cache[d],c.isCached=!0,b(null,c)):(this._log("Cache miss"),this._submitJobToAPI(a,function(a,c){a?console.error("Something went wrong",a):this._cache[d]=c,this._log("Processing done..."),b(a,c)}.bind(this)))},a.prototype._submitJobToAPI=function(a,b){return $.get(this.getAPIRequestURL(a)).always(function(c,d,e){this._log("API Request: "+e.status),429===e.status?b("Throttling Error, try later"):this._pollForMetadata(a,function(c,d){b(null,{metadata:d,previewURL:this.getPreviewURL(a)})}.bind(this))}.bind(this))},a.prototype._pollForMetadata=function(a,b){var c=function(){return this._log("Polling for metadata..."),$.getJSON(this.getMetadataURL(a),function(a){b(null,a)}).fail(function(){setTimeout(c,1e3)})}.bind(this);return c()},a.prototype.getAPIRequestURL=function(a){return b+a},a.prototype.getMetadataURL=function(a){return this.resultsUrl+this.hash(a)+"/metadata.json"},a.prototype.getPreviewURL=function(a){return this.resultsUrl+this.hash(a)+"/"+this.getPreviewFilename(this.getFilename(a))+"_original_1.png"},a.prototype.getFilename=function(a){return a.split("/").pop()},a.prototype.getPreviewFilename=function(a){return a.substr(0,a.lastIndexOf("."))||a},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=a:window.FilePreviews=a,a}();